filament_calculator.html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filament Estimator PWA</title>
    
    <!-- PWA REQUIRED LINKS -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://placehold.co/192x192/162447/ffffff?text=FILAMENT">
    
    <!-- PWA METADATA -->
    <meta name="theme-color" content="#162447"> 
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styling for a modern, high-contrast look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e; /* Deep purple/blue background */
            color: #ffffff; /* White text */
        }
        .card {
            background-color: #162447; /* Slightly darker card background */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        /* --- INPUT/SELECT STYLES FOR HIGH CONTRAST --- */
        /* Shared styles */
        .input-style, .select-style {
            color: #1a1a2e; /* Dark text for contrast */
            border: 1px solid #4a5a7a;
            padding: 0.25rem 0.5rem;
            transition: all 0.2s;
            height: 2.3rem; 
            text-align: center !important; 
        }

        /* Specific styles for input boxes (white) */
        .input-style {
            background-color: #ffffff;
        }
        
        /* Specific styles for dropdowns (darker light blue) */
        .select-style {
            background-color: #99d8ee; 
        }
        
        .input-style:focus, .select-style:focus {
            border-color: #e53e3e; /* Focus color: Red */
            ring: 2px solid #e53e3e;
            outline: none;
        }
    </style>
</head>
<!-- The flex utilities here ensure the content is centered -->
<body class="p-4 flex items-center justify-center min-h-screen">

    <!-- Main Card Container -->
    <div class="card w-full max-w-2xl p-4 md:p-6 rounded-xl space-y-4">
        
        <h1 class="text-2xl font-bold text-center text-red-400">Remaining Filament Estimator</h1>
        
        <!-- SECTION 1: Filament Material Data -->
        <!-- Background color: Dark Gray (#1f2937, Tailwind gray-800) -->
        <div class="bg-[#1f2937] p-4 rounded-lg">
            <h2 class="text-xl font-semibold text-red-300 border-b border-red-500/50 pb-1 mb-3">Filament Material Data</h2>
            
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-5">
                
                <!-- 1. Filament Type (Dropdown) -->
                <div>
                    <div class="flex items-center space-x-3">
                        <label for="filamentType" class="text-base font-medium text-gray-300 flex-shrink-0 w-2/5">Material</label>
                        <select id="filamentType" class="select-style flex-grow rounded-lg appearance-none cursor-pointer text-center">
                            <!-- Density values are stored in g/mm³ for calculation (g/cm³ / 1000) -->
                            <option value="0.00124">PLA (Standard)</option>
                            <option value="0.00125">Hyper PLA / PLA+</option>
                            <option value="0.00128">PLA (Carbon/Composite)</option>
    
                            <option value="0.00127">PETG (Standard)</option>
                            <option value="0.00128">Hyper PETG</option>
                            <option value="0.00130">PETG (Carbon Fiber)</option>
                            
                            <option value="0.00120">TPU (95A, Standard)</option>
                            <option value="0.00115">TPU (85A / Soft)</option>
    
                            <option value="0.00104">ABS</option>
                            <option value="0.00115">Nylon</option>
                        </select>
                    </div>
                    
                    <!-- Density Display -->
                    <div class="flex items-center space-x-3 mt-2">
                        <label class="text-base font-medium text-gray-300 flex-shrink-0 w-2/5">Density (g/cm³)</label>
                        
                        <div id="densityDisplayWrapper" class="select-style flex-grow rounded-lg flex items-center justify-center bg-[#2a3a5a] text-white p-1 h-[2.3rem]" style="cursor: default; pointer-events: none; border: 1px solid #e53e3e;">
                            <p id="densityDisplay" class="text-sm font-bold text-white">0.00 g/cm³</p>
                        </div>
                    </div>
                </div>
    
                <!-- 2. Filament Diameter (Size) -->
                <div class="flex items-center space-x-3">
                    <!-- SHORTENED LABEL -->
                    <label for="filamentDiameter" class="text-base font-medium text-gray-300 flex-shrink-0 w-2/5">Fil. Dia. (mm)</label>
                    <select id="filamentDiameter" class="select-style flex-grow rounded-lg appearance-none cursor-pointer text-center">
                        <option value="1.75">1.75 mm</option>
                        <option value="2.85">2.85 mm</option>
                    </select>
                </div>
    
                <!-- 3. Original Filament Weight -->
                <div class="flex items-center space-x-3">
                    <!-- SHORTENED LABEL -->
                    <label for="originalWeight" class="text-base font-medium text-gray-300 flex-shrink-0 w-2/5">Orig. Wt. (g)</label>
                    <select id="originalWeight" class="select-style flex-grow rounded-lg appearance-none cursor-pointer text-center">
                        <option value="1000">1000 g</option>
                        <option value="750">750 g</option>
                        <option value="500">500 g</option>
                        <option value="250">250 g</option>
                        <option value="2000">2000 g</option>
                    </select>
                </div>
            </div>
        </div>


        <!-- SECTION 2: Manual Spool Dimensions -->
        <!-- Background color: Slightly Lighter Dark Blue (#1d2d50) -->
        <div class="bg-[#1d2d50] p-4 rounded-lg">
            <h2 class="text-xl font-semibold text-red-300 border-b border-red-500/50 pb-1 mb-3">Manual Spool Dimensions</h2>
            <div class="space-y-3">
                <!-- Row 1: Diameter and Core -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                    
                    <!-- 4. Overall Spool Diameter -->
                    <div class="flex items-center space-x-3">
                        <!-- SHORTENED LABEL -->
                        <label for="spoolOuterDiameter" class="text-base font-medium text-gray-300 flex-shrink-0 w-1/2">Spool Dia. (mm)</label>
                        <input type="number" id="spoolOuterDiameter" placeholder="200" class="input-style flex-grow rounded-lg text-center" value="200" step="1">
                    </div>
    
                    <!-- 5. Core Width (Inner Diameter) -->
                    <div class="flex items-center space-x-3">
                        <!-- ALREADY SHORT -->
                        <label for="spoolCoreDiameter" class="text-base font-medium text-gray-300 flex-shrink-0 w-1/2">Core Dia. (mm)</label>
                        <input type="number" id="spoolCoreDiameter" placeholder="90" class="input-style flex-grow rounded-lg text-center" value="90" step="1">
                    </div>
                </div>
    
                <!-- Row 2: Width and Depth -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-5">
                    <!-- 6. Spool Width (Internal) -->
                    <div class="flex items-center space-x-3">
                        <!-- UPDATED LABEL -->
                        <label for="spoolWidth" class="text-base font-medium text-gray-300 flex-shrink-0 w-1/2">Inner Wdth. (mm)</label>
                        <input type="number" id="spoolWidth" placeholder="65" class="input-style flex-grow rounded-lg text-center" value="65" step="1">
                    </div>
                    
                    <!-- 7. Depth to Filament -->
                    <div class="flex items-center space-x-3">
                        <!-- SHORTENED LABEL -->
                        <label for="emptySpaceDepth" class="text-base font-medium text-gray-300 flex-shrink-0 w-1/2">Filament Depth (mm)</label>
                        <input type="number" id="emptySpaceDepth" placeholder="20" class="input-style flex-grow rounded-lg text-center" value="20" step="1">
                    </div>
                </div>
            </div>
        </div>

        <!-- SECTION 3: Results Display -->
        <!-- Background color: Dark Gray (#1f2937, same as section 1 for symmetry) -->
        <div class="bg-[#1f2937] p-4 rounded-lg">
            <h2 class="text-xl font-semibold text-red-300 border-b border-red-500/50 pb-1 mb-3" id="resultsTitle">Estimated Results</h2>
            
            <div id="results" class="space-y-3">
                
                <!-- Result 1: Estimated Weight -->
                <div class="flex items-center space-x-3">
                    <!-- SHORTENED LABEL -->
                    <label class="text-base font-medium text-gray-300 flex-shrink-0 w-1/2 whitespace-nowrap">Remaining Wt (g)</label>
                    <div class="bg-[#2a3a5a] w-1/2 rounded-lg flex items-center justify-center p-1 h-7">
                        <p id="resultWeight" class="text-base font-extrabold text-white">0 g</p>
                    </div>
                </div>
    
                <!-- Result 2: Estimated Length - CHANGED TO mm -->
                <div class="flex items-center space-x-3">
                    <!-- SHORTENED LABEL -->
                    <label class="text-base font-medium text-gray-300 flex-shrink-0 w-1/2">Remaining Length (mm)</label>
                    <div class="bg-[#2a3a5a] w-1/2 rounded-lg flex items-center justify-center p-1 h-7">
                        <p id="resultLength" class="text-base font-extrabold text-white">0 mm</p>
                    </div>
                </div>
    
                <!-- Result 3: Percentage Remaining - DYNAMICALLY COLORED -->
                <div class="flex items-center space-x-3">
                    <!-- ALREADY SHORT -->
                    <label class="text-base font-medium text-gray-300 flex-shrink-0 w-1/2">Percentage Left (%)</label>
                    <div id="resultPercentageWrapper" class="w-1/2 rounded-lg flex items-center justify-center p-1 h-7 transition-colors duration-300 bg-gray-600">
                        <p id="resultPercentage" class="text-base font-extrabold text-white">0%</p>
                    </div>
                </div>
            </div>
        </div>


        <!-- Status Message (Keep outside the themed sections) -->
        <div id="statusMessage" class="text-center text-sm p-3 rounded-lg bg-yellow-900/50 text-yellow-300 mt-2" style="display:none;"></div>
    </div>

    <script>
        // Constants for calculation
        const PI = Math.PI;

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
          window.addEventListener('load', () => {
            // Registering the service worker (it will be provided in the next file block)
            navigator.serviceWorker.register('./sw.js')
              .then(registration => console.log('SW registered: ', registration.scope))
              .catch(error => console.log('SW registration failed: ', error));
          });
        }
        
        // Function to update the density display box
        function updateDensityDisplay() {
            const density_g_mm3 = parseFloat(document.getElementById('filamentType').value);
            // Convert g/mm³ to g/cm³ for user readability (multiply by 1000)
            const density_g_cm3 = density_g_mm3 * 1000;
            document.getElementById('densityDisplay').textContent = `${density_g_cm3.toFixed(2)} g/cm³`;
        }

        // Function to handle the calculation and display results
        function calculateRemaining() {
            // Update the density display first
            updateDensityDisplay();

            // Material Inputs
            const filamentType = parseFloat(document.getElementById('filamentType').value); // Density (g/mm³)
            const diameter = parseFloat(document.getElementById('filamentDiameter').value); // Filament Diameter (mm)
            const originalWeight = parseFloat(document.getElementById('originalWeight').value); // Original package weight (g)
            
            // Dimensional Inputs
            const spoolOuterDiameter = parseFloat(document.getElementById('spoolOuterDiameter').value); // Overall Spool Diameter (mm)
            const spoolCoreDiameter = parseFloat(document.getElementById('spoolCoreDiameter').value); // Inner Core Diameter (mm)
            const spoolWidth = parseFloat(document.getElementById('spoolWidth').value); // Winding Width (mm)
            const emptySpaceDepth = parseFloat(document.getElementById('emptySpaceDepth').value); // Radial empty space from spool edge (mm)

            
            const resultsDiv = document.getElementById('results');
            const resultsTitle = document.getElementById('resultsTitle'); // Reference to the new H2 title
            const statusMessage = document.getElementById('statusMessage');
            statusMessage.style.display = 'none';

            // --- Calculation Helper Constants ---
            // Cross-sectional area (A) in mm²: A = π * r²
            const filamentRadius = diameter / 2;
            const crossSectionalArea = PI * Math.pow(filamentRadius, 2);

            // Volume per gram (V/m) in mm³ per g: V/m = 1 / density (ρ is in g/mm³)
            const volumePerGram = 1 / filamentType; // mm³ / g

            let hasError = false;
            let estimatedRemainingWeight = 0;
            // Renamed to _mm, calculated in mm
            let estimatedRemainingLength_mm = 0; 

            // =========================================================
            // 1. DIMENSIONAL CALCULATION
            // =========================================================

            if (isNaN(spoolOuterDiameter) || isNaN(spoolCoreDiameter) || isNaN(spoolWidth) || isNaN(emptySpaceDepth) || spoolOuterDiameter <= 0 || spoolCoreDiameter <= 0 || spoolWidth <= 0 || emptySpaceDepth < 0) {
                // If dimensional data is missing/invalid, show error
                statusMessage.textContent = "Error: Please ensure all dimensional inputs (Spool Diameters, Width, and Depth) are valid, non-zero numbers.";
                statusMessage.style.display = 'block';
                hasError = true;
            } else {
                // Calculate the diameter of the remaining wound filament
                // D_wound = D_spool - 2 * H_empty (We subtract the depth from both sides of the spool)
                const woundFilamentDiameter = spoolOuterDiameter - (2 * emptySpaceDepth); // mm

                if (woundFilamentDiameter < spoolCoreDiameter) {
                    // Check if spool is empty (wound diameter less than core diameter)
                    if (woundFilamentDiameter < spoolCoreDiameter * 0.95) { // Use a small buffer for error checking
                        statusMessage.textContent = "Warning: The calculated filament winding diameter is less than or equal to the spool core. Spool is likely empty.";
                        statusMessage.style.display = 'block';
                    }
                    estimatedRemainingWeight = 0;
                    estimatedRemainingLength_mm = 0; // Set to 0 mm
                } else if (woundFilamentDiameter > spoolOuterDiameter) {
                    statusMessage.textContent = "Error: Filament diameter calculation is impossible. Check your Filament Depth—it cannot be a negative value or too small.";
                    statusMessage.style.display = 'block';
                    hasError = true;
                }
                else {
                    // Volume of the hollow cylinder (Filament Roll) in mm³
                    // V = π * W * (R_wound² - R_core²)
                    const R_wound = woundFilamentDiameter / 2;
                    const R_core = spoolCoreDiameter / 2;

                    const filamentVolume_mm3 = PI * spoolWidth * (Math.pow(R_wound, 2) - Math.pow(R_core, 2));

                    // Estimated Remaining Weight (g)
                    estimatedRemainingWeight = filamentVolume_mm3 * filamentType; // Mass = Volume * Density

                    // Estimated Remaining Length (mm)
                    // Length (mm) = Volume / Cross-sectional Area of filament
                    // Note: This result is already in mm.
                    estimatedRemainingLength_mm = estimatedRemainingWeight * volumePerGram / crossSectionalArea;
                }
            }
            
            // --- Percentage Calculation (Uses Original Weight) ---
            let percentageRemaining = 0;
            if (originalWeight > 0 && estimatedRemainingWeight > 0) {
                percentageRemaining = (estimatedRemainingWeight / originalWeight) * 100;
                if (percentageRemaining > 100) {
                    statusMessage.textContent = "Warning: Estimated weight exceeds original spool weight. Check your measurements or density settings.";
                    statusMessage.style.display = 'block';
                    percentageRemaining = 100; // Cap at 100%
                }
            }

            const percentageWrapper = document.getElementById('resultPercentageWrapper');
            // 1. Reset all potential background classes
            percentageWrapper.classList.remove('bg-green-600', 'bg-yellow-600', 'bg-red-600', 'bg-gray-600'); 

            // --- Display Results ---
            // NOTE: We no longer hide the results section on error, we just display '---'
            if (hasError) {
                document.getElementById('resultWeight').textContent = `---`;
                document.getElementById('resultLength').textContent = `---`;
                document.getElementById('resultPercentage').textContent = `---`;
                percentageWrapper.classList.add('bg-gray-600'); // Neutral color on error
            } else {

                // 2. Apply status color based on percentage
                if (percentageRemaining > 50) {
                    percentageWrapper.classList.add('bg-green-600');
                } else if (percentageRemaining > 20) {
                    percentageWrapper.classList.add('bg-yellow-600');
                } else {
                    percentageWrapper.classList.add('bg-red-600');
                }
                
                document.getElementById('resultWeight').textContent = `${estimatedRemainingWeight.toFixed(1)} g`;
                // Displaying length as whole number since it's a large value in mm
                document.getElementById('resultLength').textContent = `${estimatedRemainingLength_mm.toFixed(0)} mm`; 
                document.getElementById('resultPercentage').textContent = `${percentageRemaining.toFixed(0)}%`;
            }

            
            // Hide the status message if there was no active error/warning
            if (!hasError && !statusMessage.textContent.startsWith('Warning:')) {
                 statusMessage.style.display = 'none';
            }
        }

        // Initialize with a calculation on load
        window.onload = function() {
            calculateRemaining();
        };

        // Add event listeners to re-calculate on input change (These were already present!)
        document.getElementById('filamentType').addEventListener('change', calculateRemaining);
        document.getElementById('filamentDiameter').addEventListener('change', calculateRemaining);
        document.getElementById('originalWeight').addEventListener('change', calculateRemaining);
        document.getElementById('spoolOuterDiameter').addEventListener('input', calculateRemaining);
        document.getElementById('spoolCoreDiameter').addEventListener('input', calculateRemaining);
        document.getElementById('spoolWidth').addEventListener('input', calculateRemaining);
        document.getElementById('emptySpaceDepth').addEventListener('input', calculateRemaining);
    </script>
</body>
</html>

